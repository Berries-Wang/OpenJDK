# JVM 内存分配与管理
## JVM如何管理内存？
&nbsp;&nbsp;JVM从操作系统申请一块内存，然后根据不同的GC算法进行管理。

&nbsp;&nbsp;通过源码可以发现，JVM通过mmap系统调用来完成内存的分配，mmap必须以PAGE_SIZE为单位进行映射，而内存也只能以页为单位进行映射。注意:
1. 若要映射非PAGE_SIZE整数倍的地址范围，要先进行内存对齐，强行以PAGE_SIZE的倍数大小进行映射。
2. 操作系统对内存的分配管理典型地分为两个阶段：
   - 保留(reserve): 保留阶段告知系统从某一地址开始到后面的dwSize大小的连续虚拟内存需要供程序使用，进程其他分配内存的操作不得使用这段内存。
   - 提交(commit): 提交阶段将虚拟地址映射到真实的物理内存中，这样这块内存就能正常使用了

---

## JVM常见的对象类型
|序号|名称|含义|
|---|---|---|
|1|ResourceObj|线程有一个资源空间，一般Resourceobj都位于这里。定义资源空间是对JVM其他功能的支持，如在C1/C2优化时可能需要访问运行时信息|
|2|StackObj|栈对象，声明的对象使用栈管理。|
|3|ValueObj|值对象，该对象在堆对象需要进行嵌套时使用，简单来说就是对象分配的位置和宿主对象是一样的|
|4|AllStatic|静态对象，全局对象，只有一个|
|5|MetaspaceObj|元对象，如InstanceKlass这样的元数据就是元对象|
|6|CHeapObj|堆空间对象，由new/delete/free/malloc管理，除了Java对象，还有其他对象也在堆中|