# OopMap
&nbsp;&nbsp;在HotSpot中，有个数据结构（映射表）称为「OopMap」。一旦类加载动作完成的时候，HotSpot就会把对象内什么偏移量上是什么类型的数据计算出来，记录到OopMap。在即时编译过程中，也会在「特定的位置」生成 OopMap，记录下栈上和寄存器里哪些位置是引用。
- 在解释执行时就没有必要生成OopMap了，因为此时本地变量表都是已知的，可以直接添加到GC Roots中.
## 功能
&nbsp;&nbsp;OopMap 记录了栈上本地变量到堆上对象的引用关系。

### Card Marking
&nbsp;&nbsp;在默认的情况下是直接赋值的，但是在高并发的情况下会导致性能问题。因此，在OpenJDK7添加了JVM参数 "-XX:+UseCondCardMark:" 来避免并发写入CardTable
### Default Card Marking
```c
   CARD_TABLE [this address >> 9] = 0;
   // The associated write to memory for card marking can sometimes
   // cause performance issues for highly concurrent code.
```

### Conditional Card Marking
```c
   // 指定了 -XX:+UseCondCardMark: 参数
   if (CARD_TABLE [this address >> 9] != 0){
     CARD_TABLE [this address >> 9] = 0; 
   } 
```

---
## 参考资料
1. [http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html](http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html)