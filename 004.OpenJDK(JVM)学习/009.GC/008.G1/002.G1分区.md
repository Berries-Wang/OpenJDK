# G1(Garbage-First Garbage Collector,垃圾优先型垃圾回收器)分区
&nbsp;&nbsp;传统的垃圾收集器将连续的内存空间划分为新生代、老年代以及永久代(JDK8去除了永久代，引入了元空间Metaspace),这种划分的特点是各代存储地址(逻辑地址)是连续的。如下图:
- <img src = "./pics/8a9db36e.png"/>

&nbsp;&nbsp;而G1的各代存储地址是不连续的，每一代都使用了n个不连续的大小相同的Region,每个Region占有一块连续的虚拟内存地址。如下图:
- <img src = "./pics/8ca16868.png"/>

&nbsp;&nbsp;Heap Region(分区)，是G1和操作系统交互的最小管理单位，G1的分区类型(HeapRegionType)大致可以分为四类:
1. 自由分区(Free Heap Region,FHR)
2. 新生代分区(Young Heap Region,YHR)
3. 大对象分区(Humongous Heap Region,HHR)
4. 老年代分区(Old Heap Region,OHR)
5. ```c
      // 005.OpenJDK/002.OpenJDK8u312-GA/OpenJDK8U312-GA/hotspot/src/share/vm/gc_implementation/g1/heapRegionType.hpp

        typedef enum {
            FreeTag       = 0,
        
            YoungMask     = 2,
            EdenTag       = YoungMask,
            SurvTag       = YoungMask + 1,
        
            HumMask       = 4,
            HumStartsTag  = HumMask,
            HumContTag    = HumMask + 1,
        
            OldTag        = 8
        }Tag;
   ```

## HR大小如何设置?
&nbsp;&nbsp;<font color="red">**G1中每个分区大小是相同的**</font>,那么如何设置HR的大小呢?

&nbsp;&nbsp;HR的大小影响着分配和垃圾回收效率。
- 过大，一个HR上可以存放多个对象，分配效率高，但是垃圾回收时花费时间过长；
- 过小,则导致分配效率低下。

&nbsp;&nbsp;HR有一个上限值和一个下限值，值如下代码。HR大小可由以下方式确定:
1. 通过参数G1HeapRegionSize来指定大小，这个参数默认值为0
2. 启发式推断，即在不指定HR大小的时候，由G1启发式地推断HR大小。

### 设置HR大小源码分析
```c

```

---
## 参考资料
1. OpenJDK版本: [005.OpenJDK/002.OpenJDK8u312-GA](../../005.OpenJDK/002.OpenJDK8u312-GA) 